
// Generated by sequelize.sync(), running as a migration to avoid unnecessary processing on startup
// Migration is recommended over sync as well for production
var baselineSql = `CREATE TABLE IF NOT EXISTS "user" ("id" VARCHAR(255) UNIQUE , "firstName" VARCHAR(255), "lastName" VARCHAR(255), "email" VARCHAR(255), "phoneNumber" VARCHAR(255), "password" VARCHAR(255), "stripeCustomerID" VARCHAR(255), "profileImageID" VARCHAR(255), "isEmailVerified" BOOLEAN, "isPhoneNumberVerified" BOOLEAN, "timeZone" VARCHAR(255) NOT NULL DEFAULT 'America/Denver', "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "mechanic" ("id" VARCHAR(255) UNIQUE , "isActive" BOOLEAN, "stripeAccountID" VARCHAR(255), "identityDocumentID" VARCHAR(255), "identityDocumentBackID" VARCHAR(255), "dateOfBirth" TIMESTAMP WITH TIME ZONE, "profileImageID" VARCHAR(255), "isAllowed" BOOLEAN NOT NULL DEFAULT false, "hasSetAvailability" BOOLEAN NOT NULL DEFAULT false, "hasSetServiceRegion" BOOLEAN NOT NULL DEFAULT false, "chargeForTravel" BOOLEAN NOT NULL DEFAULT true, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "userID" VARCHAR(255) REFERENCES "user" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "referrer" ("id" VARCHAR(255) UNIQUE , "sourceType" VARCHAR(255) NOT NULL, "externalId" VARCHAR(255), "description" VARCHAR(255), "stripeExpressAccountID" VARCHAR(255), "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "userID" VARCHAR(255) REFERENCES "user" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "couponID" VARCHAR(255), PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "coupon" ("id" VARCHAR(255) UNIQUE , "amountOff" INTEGER, "percentOff" FLOAT, "redemptions" INTEGER, "maxRedemptions" INTEGER, "maxRedemptionsPerUser" INTEGER, "name" VARCHAR(255) NOT NULL, "redeemBy" TIMESTAMP WITH TIME ZONE NOT NULL, "discountBookingFee" BOOLEAN NOT NULL, "isCorporate" BOOLEAN NOT NULL, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "createdByUserID" VARCHAR(255) REFERENCES "user" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "createdByMechanicID" VARCHAR(255) REFERENCES "mechanic" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "referrerID" VARCHAR(255) REFERENCES "referrer" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "vehicle" ("id" VARCHAR(255) UNIQUE , "licensePlate" VARCHAR(255), "state" VARCHAR(255), "name" VARCHAR(255), "vin" VARCHAR(255), "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "userID" VARCHAR(255) REFERENCES "user" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "autoService" ("id" VARCHAR(255) UNIQUE , "scheduledDate" TIMESTAMP WITH TIME ZONE, "status" VARCHAR(255), "transferID" VARCHAR(255), "balanceTransactionID" VARCHAR(255), "transferAmount" INTEGER, "invoiceID" VARCHAR(255), "chargeID" VARCHAR(255), "refundID" VARCHAR(255), "transferReversalID" VARCHAR(255), "notes" VARCHAR(255), "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "userID" VARCHAR(255) REFERENCES "user" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "mechanicID" VARCHAR(255) REFERENCES "mechanic" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "couponID" VARCHAR(255) REFERENCES "coupon" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "vehicleID" VARCHAR(255) REFERENCES "vehicle" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "location" ("id" VARCHAR(255) UNIQUE , "point" GEOMETRY(POINT), "streetAddress" VARCHAR(255), "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "autoServiceID" VARCHAR(255) REFERENCES "autoService" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "mechanicID" VARCHAR(255) REFERENCES "mechanic" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "oilChange" ("id" VARCHAR(255) UNIQUE , "oilType" VARCHAR(255), "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "price" ("id" VARCHAR(255) UNIQUE , "totalPrice" INTEGER, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "autoServiceID" VARCHAR(255) REFERENCES "autoService" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "pricePart" ("id" VARCHAR(255) UNIQUE , "key" VARCHAR(255), "value" INTEGER, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "priceID" VARCHAR(255) REFERENCES "price" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "vehicleDescription" ("id" VARCHAR(255) UNIQUE , "make" VARCHAR(255), "model" VARCHAR(255), "style" VARCHAR(255), "trim" VARCHAR(255), "year" VARCHAR(255), "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "vehicleID" VARCHAR(255) REFERENCES "vehicle" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "region" ("id" VARCHAR(255) UNIQUE , "origin" GEOMETRY(POINT), "radius" DOUBLE PRECISION, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "mechanicID" VARCHAR(255) REFERENCES "mechanic" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "templateTimeSpan" ("id" VARCHAR(255) UNIQUE , "startTime" TIME NOT NULL, "weekDay" SMALLINT NOT NULL, "duration" DOUBLE PRECISION NOT NULL, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "mechanicID" VARCHAR(255) REFERENCES "mechanic" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "serviceEntity" ("id" VARCHAR(255) UNIQUE , "entityType" VARCHAR(255) NOT NULL, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "autoServiceID" VARCHAR(255) REFERENCES "autoService" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "oilChangeID" VARCHAR(255) REFERENCES "oilChange" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "deviceToken" ("id" VARCHAR(255) UNIQUE , "token" VARCHAR(255), "pushType" VARCHAR(255) NOT NULL DEFAULT 'APNS', "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "userID" VARCHAR(255) REFERENCES "user" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "mechanicID" VARCHAR(255) REFERENCES "mechanic" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "address" ("id" VARCHAR(255) UNIQUE , "line1" VARCHAR(255), "line2" VARCHAR(255), "postalCode" VARCHAR(255), "city" VARCHAR(255), "state" VARCHAR(255), "country" VARCHAR(255), "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "mechanicID" VARCHAR(255) REFERENCES "mechanic" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "review" ("id" VARCHAR(255) UNIQUE , "rating" FLOAT NOT NULL, "text" VARCHAR(255), "reviewerID" VARCHAR(255), "revieweeID" VARCHAR(255), "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "userID" VARCHAR(255) REFERENCES "user" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "autoServiceIDFromUser" VARCHAR(255) REFERENCES "autoService" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "autoServiceIDFromMechanic" VARCHAR(255) REFERENCES "autoService" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "mechanicID" VARCHAR(255) REFERENCES "mechanic" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "verification" ("id" VARCHAR(255) UNIQUE , "resourceID" VARCHAR(255) NOT NULL, "resourceType" VARCHAR(255) NOT NULL, "creationDate" TIMESTAMP WITH TIME ZONE NOT NULL, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "transactionMetadata" ("id" VARCHAR(255) UNIQUE , "stripeTransactionID" VARCHAR(255), "mechanicCost" INTEGER, "drivingDistance" INTEGER, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "autoServiceID" VARCHAR(255) REFERENCES "autoService" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "mechanicID" VARCHAR(255) REFERENCES "mechanic" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "transactionReceipt" ("id" VARCHAR(255) UNIQUE , "receiptPhotoID" VARCHAR(255), "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "transactionMetadataID" VARCHAR(255) REFERENCES "transactionMetadata" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "mechanicMonthDebit" ("id" VARCHAR(255) UNIQUE , "debitMonth" INTEGER, "debitYear" INTEGER, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "mechanicID" VARCHAR(255) REFERENCES "mechanic" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "mechanicPayoutDebit" ("id" VARCHAR(255) UNIQUE , "payoutID" VARCHAR(255) NOT NULL, "mechanicID" VARCHAR(255) NOT NULL REFERENCES "mechanic" ("id") ON DELETE NO ACTION ON UPDATE CASCADE, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "oilChangePricing" ("id" VARCHAR(255) UNIQUE , "conventional" INTEGER NOT NULL DEFAULT 4500, "conventionalPerQuart" INTEGER NOT NULL DEFAULT 900, "blend" INTEGER NOT NULL DEFAULT 5000, "blendPerQuart" INTEGER NOT NULL DEFAULT 1000, "synthetic" INTEGER NOT NULL DEFAULT 5600, "syntheticPerQuart" INTEGER NOT NULL DEFAULT 1120, "highMileage" INTEGER NOT NULL DEFAULT 5850, "highMileagePerQuart" INTEGER NOT NULL DEFAULT 1170, "centsPerMile" INTEGER NOT NULL DEFAULT 50, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "mechanicID" VARCHAR(255) REFERENCES "mechanic" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "passwordReset" ("id" VARCHAR(255) UNIQUE , "token" VARCHAR(255) NOT NULL, "email" VARCHAR(255) NOT NULL, "expirationDate" TIMESTAMP WITH TIME ZONE, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "subscriptionSettings" ("id" VARCHAR(255) UNIQUE , "userID" VARCHAR(255) NOT NULL, "sendReminderEmails" BOOLEAN NOT NULL DEFAULT true, "unsubscribeID" VARCHAR(255) NOT NULL, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "authority" ("id" VARCHAR(255) UNIQUE , "authorityName" VARCHAR(255) NOT NULL, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "userID" VARCHAR(255) REFERENCES "user" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "authorityRequest" ("id" VARCHAR(255) UNIQUE , "secretID" VARCHAR(255) NOT NULL, "authorityName" VARCHAR(255) NOT NULL, "expirationDate" TIMESTAMP WITH TIME ZONE NOT NULL, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "authorityID" VARCHAR(255) REFERENCES "authority" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "requesterID" VARCHAR(255) REFERENCES "user" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "authorityConfirmation" ("id" VARCHAR(255) UNIQUE , "status" VARCHAR(255) NOT NULL, "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "authorityID" VARCHAR(255) REFERENCES "authority" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "confirmerID" VARCHAR(255) REFERENCES "user" ("id") ON DELETE SET NULL ON UPDATE CASCADE, "authorityRequestID" VARCHAR(255) REFERENCES "authorityRequest" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));
CREATE TABLE IF NOT EXISTS "payStructure" ("id"   SERIAL , "percentageOfPurchase" DECIMAL(5,4) NOT NULL, "maxNumberOfPurchases" INTEGER NOT NULL, "maxNumberOfPurchasesPerUser" INTEGER NOT NULL DEFAULT '1', "getPaidEvenIfCouponIsApplied" BOOLEAN NOT NULL DEFAULT '1', "createdAt" TIMESTAMP WITH TIME ZONE NOT NULL, "updatedAt" TIMESTAMP WITH TIME ZONE NOT NULL, "referrerID" VARCHAR(255) REFERENCES "referrer" ("id") ON DELETE SET NULL ON UPDATE CASCADE, PRIMARY KEY ("id"));`;

module.exports = {
    up: (queryInterface) => {
        return new Promise(async (resolve, reject) => {
            queryInterface.sequelize.query(baselineSql)
                .then(() => {
                    console.info("Completed baseline migration")
                    resolve();
                })
                .catch(errors => {
                    console.error("Failed to perform baseline");
                    reject();
                })
        });
    },

    down: (queryInterface) => {
        // Should never need this
        return new Promise((resolve, reject) => { resolve(); });
    }
};
